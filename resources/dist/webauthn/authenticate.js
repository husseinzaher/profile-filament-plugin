var w=()=>{if(document.querySelector('meta[name="csrf-token"]'))return document.querySelector('meta[name="csrf-token"]').getAttribute("content");if(document.querySelector("[data-csrf]"))return document.querySelector("[data-csrf]").getAttribute("data-csrf");if(window.livewireScriptConfig.csrf??!1)return window.livewireScriptConfig.csrf;throw new Error("No CSRF token detected")},S=e=>Array.isArray(e),I=e=>typeof e=="object"&&e!==null,b=e=>I(e)&&!S(e),R=e=>typeof e=="function",f=(e,t)=>t in e;var m={hasErrors(){return Object.keys(this.$wire.__instance?.snapshot?.memo?.errors??{}).length>0},notifyPublicKeyError(){new FilamentNotification().danger().title("Error").body("We encountered a fatal error in the key generation process. Please try again later.").send()},isValidPublicKey(e,t="rpId"){return b(e)&&f(e,"challenge")&&f(e,t)},_ajaxOptions(e={}){return{method:"POST",headers:{"Content-Type":"application/json","X-Webauthn":""},body:JSON.stringify({_token:w(),...e})}}};function u(e){let t=new Uint8Array(e),n="";for(let i of t)n+=String.fromCharCode(i);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function y(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,o=t.padEnd(t.length+n,"="),i=atob(o),r=new ArrayBuffer(i.length),s=new Uint8Array(r);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return r}function d(){return window?.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}function P(e){let{id:t}=e;return{...e,id:y(t),transports:e.transports}}function C(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}var c=class extends Error{constructor({message:t,code:n,cause:o,name:i}){super(t,{cause:o}),this.name=i??o.name,this.code=n}};var h=class{createNewAbortSignal(){if(this.controller){let n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}let t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){let t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}},T=new h,N=["cross-platform","platform"];function K(e){if(e&&!(N.indexOf(e)<0))return e}function D(){if(!d())return new Promise(t=>t(!1));let e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(t=>t(!1)):e.isConditionalMediationAvailable()}function U({error:e,options:t}){let{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new c({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){let o=window.location.hostname;if(C(o)){if(n.rpId!==o)return new c({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function E(e){let{optionsJSON:t,useBrowserAutofill:n=!1,verifyBrowserAutofillInput:o=!0}=e;if(!d())throw new Error("WebAuthn is not supported in this browser");let i;t.allowCredentials?.length!==0&&(i=t.allowCredentials?.map(P));let r={...t,challenge:y(t.challenge),allowCredentials:i},s={};if(n){if(!await D())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&o)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');s.mediation="conditional",r.allowCredentials=[]}s.publicKey=r,s.signal=T.createNewAbortSignal();let a;try{a=await navigator.credentials.get(s)}catch(g){throw U({error:g,options:s})}if(!a)throw new Error("Authentication was not completed");let{id:A,rawId:O,response:l,type:_}=a,p;return l.userHandle&&(p=u(l.userHandle)),{id:A,rawId:u(O),response:{authenticatorData:u(l.authenticatorData),clientDataJSON:u(l.clientDataJSON),signature:u(l.signature),userHandle:p},type:_,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:K(a.authenticatorAttachment)}}var v=({publicKey:e=void 0,publicKeyUrl:t=void 0,loginMethod:n="authenticate",loginUsing:o=void 0})=>({publicKey:e,publicKeyUrl:t,loginMethod:n,loginUsing:o,error:null,processing:!1,browserSupportsWebAuthn:d,...m,async login(){let i=this.publicKey;if(this.processing=!0,this.error=null,this.publicKeyUrl){let r=await fetch(this.publicKeyUrl,this._ajaxOptions());if(!r.ok)return this.processing=!1,this.notifyPublicKeyError();i=await r.json()}return this.isValidPublicKey(i)?E({optionsJSON:i}).then(async r=>{if(R(this.loginUsing)){await this.loginUsing.bind(this)(r);return}await this.$wire.call(this.loginMethod,r)}).catch(r=>{this.error=r?.response?.data?.message??r,this.$wire.call("$refresh")}).finally(()=>this.processing=!1):(this.processing=!1,this.notifyPublicKeyError())}}),j=v;export{j as default};
